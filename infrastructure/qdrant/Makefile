# Qdrant ê´€ë¦¬ ëª…ë ¹ì–´

.PHONY: help start stop restart logs status test clean

help:  ## ë„ì›€ë§ í‘œì‹œ
	@grep -E '^[a-zA-Z_-]+:.*?## .*$$' $(MAKEFILE_LIST) | sort | awk 'BEGIN {FS = ":.*?## "}; {printf "\033[36m%-15s\033[0m %s\n", $$1, $$2}'

start:  ## Qdrant ì‹œì‘
	@echo "ğŸš€ Qdrant ì‹œì‘ ì¤‘..."
	docker-compose up -d
	@echo "âœ… Qdrant ì‹œì‘ ì™„ë£Œ"
	@echo "ğŸ“Š ì›¹ UI: http://localhost:6333/dashboard"

stop:  ## Qdrant ì¤‘ì§€
	@echo "â¹ï¸  Qdrant ì¤‘ì§€ ì¤‘..."
	docker-compose down
	@echo "âœ… Qdrant ì¤‘ì§€ ì™„ë£Œ"

restart:  ## Qdrant ì¬ì‹œì‘
	@echo "ğŸ”„ Qdrant ì¬ì‹œì‘ ì¤‘..."
	docker-compose restart
	@echo "âœ… Qdrant ì¬ì‹œì‘ ì™„ë£Œ"

logs:  ## ë¡œê·¸ í™•ì¸
	docker-compose logs -f qdrant

status:  ## ìƒíƒœ í™•ì¸
	@echo "ğŸ“Š Qdrant ìƒíƒœ:"
	@docker-compose ps
	@echo ""
	@echo "í—¬ìŠ¤ì²´í¬:"
	@curl -s http://localhost:6333/healthz || echo "âŒ Qdrantê°€ ì‹¤í–‰ ì¤‘ì´ì§€ ì•ŠìŠµë‹ˆë‹¤"

test:  ## ì—°ê²° í…ŒìŠ¤íŠ¸
	@echo "ğŸ§ª Qdrant ì—°ê²° í…ŒìŠ¤íŠ¸..."
	python3 test-connection.py

clean:  ## ë°ì´í„° ì‚­ì œ ë° ì¬ì‹œì‘
	@echo "âš ï¸  ëª¨ë“  ë°ì´í„°ê°€ ì‚­ì œë©ë‹ˆë‹¤. ê³„ì†í•˜ì‹œê² ìŠµë‹ˆê¹Œ? [y/N] " && read ans && [ $${ans:-N} = y ]
	@echo "ğŸ—‘ï¸  ë°ì´í„° ì‚­ì œ ì¤‘..."
	docker-compose down -v
	rm -rf qdrant_storage qdrant_snapshots
	@echo "ğŸš€ Qdrant ì¬ì‹œì‘ ì¤‘..."
	docker-compose up -d
	@echo "âœ… ì™„ë£Œ"

backup:  ## ìŠ¤ëƒ…ìƒ· ë°±ì—…
	@echo "ğŸ’¾ ìŠ¤ëƒ…ìƒ· ìƒì„± ì¤‘..."
	@mkdir -p backups
	@DATE=$$(date +%Y%m%d_%H%M%S) && \
		docker-compose exec -T qdrant wget -O- http://localhost:6333/collections/documents/snapshots && \
		echo "âœ… ë°±ì—… ì™„ë£Œ: backups/snapshot_$$DATE"

install-deps:  ## Python ì˜ì¡´ì„± ì„¤ì¹˜
	pip install qdrant-client

ui:  ## ì›¹ UI ì—´ê¸°
	@echo "ğŸ“Š ì›¹ UI ì—´ê¸°..."
	@open http://localhost:6333/dashboard || xdg-open http://localhost:6333/dashboard || echo "ë¸Œë¼ìš°ì €ì—ì„œ http://localhost:6333/dashboard ë¥¼ ì—´ì–´ì£¼ì„¸ìš”"
